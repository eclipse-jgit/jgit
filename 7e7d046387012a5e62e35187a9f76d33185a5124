{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "88121776_e672f9bd",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1015244
      },
      "writtenOn": "2024-05-15T21:03:53Z",
      "side": 1,
      "message": "This causes the generation of an invalid bitmap, which in turns prevents cloning:\n\n```\nremote: Enumerating objects: 343283, done.\nremote: Counting objects: 100% (924/924), done.\nremote: Compressing objects: 100% (174/174), done.\nremote: Total 343283 (delta 798), reused 750 (delta 750), pack-reused 342359\nReceiving objects: 100% (343283/343283), 211.25 MiB | 101.56 MiB/s, done.\nResolving deltas: 100% (84611/84611), done.\nfatal: did not receive expected object 0300a07e21cb6cdb7df84d5d1f97f64346522b98\nfatal: fetch-pack: invalid index-pack output\ngit clone --no-checkout --no-local /Users/syntonyze/ghs/ghs-gym.git   4.67s user 1.89s system 150% cpu 4.356 total\n```\n\nLooks like the generated bitmap cannot be used, causing git to count the objects and only finding 924.\nRemoving the generated bitmap allows the clone to complete successfully:\n\n```\nremote: Enumerating objects: 497195, done.\nremote: Counting objects: 100% (458101/458101), done.\nremote: Compressing objects: 100% (322219/322219), done.\nremote: Total 497195 (delta 135718), reused 458083 (delta 135701), pack-reused 39094\nReceiving objects: 100% (497195/497195), 342.04 MiB | 115.40 MiB/s, done.\nResolving deltas: 100% (155140/155140), done.\ngit clone --no-checkout --no-local /Users/syntonyze/ghs/ghs-gym.git   10.63s user 2.86s system 118% cpu 11.333 total\n```\n\nThis occurs even when the number of slices used by Compute bitmaps in parallel slices is 1, so it seems a problem with the algorithm, not a concurrency problem.",
      "revId": "7e7d046387012a5e62e35187a9f76d33185a5124",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ec7f61c3_b9689f4b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1015244
      },
      "writtenOn": "2024-05-15T21:21:18Z",
      "side": 1,
      "message": "The following tests are failing:\n\n```\n[ERROR] Tests run: 8, Failures: 4, Errors: 0, Skipped: 0, Time elapsed: 38.92 s \u003c\u003c\u003c FAILURE! -- in org.eclipse.jgit.internal.storage.pack.GcCommitSelectionTest\n[ERROR] org.eclipse.jgit.internal.storage.pack.GcCommitSelectionTest.testBitmapsForExcessiveBranches -- Time elapsed: 34.88 s \u003c\u003c\u003c FAILURE!\njava.lang.AssertionError: expected:\u003c210\u003e but was:\u003c182\u003e\n        at org.junit.Assert.fail(Assert.java:89)\n        at org.junit.Assert.failNotEquals(Assert.java:835)\n        at org.junit.Assert.assertEquals(Assert.java:647)\n        at org.junit.Assert.assertEquals(Assert.java:633)\n        at org.eclipse.jgit.internal.storage.pack.GcCommitSelectionTest.testBitmapsForExcessiveBranches(GcCommitSelectionTest.java:217)\n        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.base/java.lang.reflect.Method.invoke(Method.java:568)\n        at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)\n        at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\n        at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)\n        at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\n        at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)\n        at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)\n        at org.junit.rules.TestWatcher$1.evaluate(TestWatcher.java:61)\n        at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)\n        at org.junit.runners.BlockJUnit4ClassRunner$1.evaluate(BlockJUnit4ClassRunner.java:100)\n        at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:366)\n        at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:103)\n        at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:63)\n        at org.junit.runners.ParentRunner$4.run(ParentRunner.java:331)\n        at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79)\n        at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329)\n        at org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)\n        at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293)\n        at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)\n        at org.junit.runners.ParentRunner.run(ParentRunner.java:413)\n        at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:316)\n        at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:240)\n        at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:214)\n        at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:155)\n        at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)\n        at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)\n        at org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)\n        at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)\n\n[ERROR] org.eclipse.jgit.internal.storage.pack.GcCommitSelectionTest.testBitmapSpansNoMergesWithTags -- Time elapsed: 0.628 s \u003c\u003c\u003c FAILURE!\njava.lang.AssertionError: 99 commits:  expected:\u003c99\u003e but was:\u003c71\u003e\n        at org.junit.Assert.fail(Assert.java:89)\n        at org.junit.Assert.failNotEquals(Assert.java:835)\n        at org.junit.Assert.assertEquals(Assert.java:647)\n        at org.eclipse.jgit.internal.storage.pack.GcCommitSelectionTest.testBitmapSpansNoMerges(GcCommitSelectionTest.java:80)\n        at org.eclipse.jgit.internal.storage.pack.GcCommitSelectionTest.testBitmapSpansNoMergesWithTags(GcCommitSelectionTest.java:44)\n        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.base/java.lang.reflect.Method.invoke(Method.java:568)\n        at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)\n        at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\n        at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)\n        at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\n        at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)\n        at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)\n        at org.junit.rules.TestWatcher$1.evaluate(TestWatcher.java:61)\n        at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)\n        at org.junit.runners.BlockJUnit4ClassRunner$1.evaluate(BlockJUnit4ClassRunner.java:100)\n        at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:366)\n        at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:103)\n        at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:63)\n        at org.junit.runners.ParentRunner$4.run(ParentRunner.java:331)\n        at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79)\n        at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329)\n        at org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)\n        at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293)\n        at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)\n        at org.junit.runners.ParentRunner.run(ParentRunner.java:413)\n        at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:316)\n        at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:240)\n        at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:214)\n        at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:155)\n        at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)\n        at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)\n        at org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)\n        at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)\n\n[ERROR] org.eclipse.jgit.internal.storage.pack.GcCommitSelectionTest.testBitmapSpansNoMerges -- Time elapsed: 0.583 s \u003c\u003c\u003c FAILURE!\njava.lang.AssertionError: 99 commits:  expected:\u003c99\u003e but was:\u003c71\u003e\n        at org.junit.Assert.fail(Assert.java:89)\n        at org.junit.Assert.failNotEquals(Assert.java:835)\n        at org.junit.Assert.assertEquals(Assert.java:647)\n        at org.eclipse.jgit.internal.storage.pack.GcCommitSelectionTest.testBitmapSpansNoMerges(GcCommitSelectionTest.java:80)\n        at org.eclipse.jgit.internal.storage.pack.GcCommitSelectionTest.testBitmapSpansNoMerges(GcCommitSelectionTest.java:39)\n        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.base/java.lang.reflect.Method.invoke(Method.java:568)\n        at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)\n        at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\n        at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)\n        at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\n        at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)\n        at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)\n        at org.junit.rules.TestWatcher$1.evaluate(TestWatcher.java:61)\n        at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)\n        at org.junit.runners.BlockJUnit4ClassRunner$1.evaluate(BlockJUnit4ClassRunner.java:100)\n        at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:366)\n        at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:103)\n        at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:63)\n        at org.junit.runners.ParentRunner$4.run(ParentRunner.java:331)\n        at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79)\n        at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329)\n        at org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)\n        at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293)\n        at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)\n        at org.junit.runners.ParentRunner.run(ParentRunner.java:413)\n        at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:316)\n        at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:240)\n        at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:214)\n        at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:155)\n        at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)\n        at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)\n        at org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)\n        at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)\n\n[ERROR] org.eclipse.jgit.internal.storage.pack.GcCommitSelectionTest.testBitmapSpansWithMerges -- Time elapsed: 0.232 s \u003c\u003c\u003c FAILURE!\njava.lang.AssertionError: 56 commits:  expected:\u003c57\u003e but was:\u003c29\u003e\n        at org.junit.Assert.fail(Assert.java:89)\n        at org.junit.Assert.failNotEquals(Assert.java:835)\n        at org.junit.Assert.assertEquals(Assert.java:647)\n        at org.eclipse.jgit.internal.storage.pack.GcCommitSelectionTest.testBitmapSpansWithMerges(GcCommitSelectionTest.java:176)\n        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.base/java.lang.reflect.Method.invoke(Method.java:568)\n        at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)\n        at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\n        at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)\n        at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\n        at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)\n        at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)\n        at org.junit.rules.TestWatcher$1.evaluate(TestWatcher.java:61)\n        at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)\n        at org.junit.runners.BlockJUnit4ClassRunner$1.evaluate(BlockJUnit4ClassRunner.java:100)\n        at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:366)\n        at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:103)\n        at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:63)\n        at org.junit.runners.ParentRunner$4.run(ParentRunner.java:331)\n        at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79)\n        at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329)\n        at org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)\n        at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293)\n        at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)\n        at org.junit.runners.ParentRunner.run(ParentRunner.java:413)\n        at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:316)\n        at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:240)\n        at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:214)\n        at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:155)\n        at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)\n        at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)\n        at org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)\n        at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)\n```",
      "revId": "7e7d046387012a5e62e35187a9f76d33185a5124",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2bcf0ab6_3ce09358",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1015244
      },
      "writtenOn": "2024-05-16T15:35:13Z",
      "side": 1,
      "message": "I found a way to replicate this failure with two commits only. for some reason it does not fail with a programmatic test (perhaps I am missing something), but I can reproduce it easily by:\n\n\n```\n# Create new repo\n\nmkdir foobar.git\ncd foobar.git\ngit init --bare\ncd /tmp\n\n# Add commit 1\ngit clone --no-local /\u003cpath\u003e/foobar.git\nFOO\u003d$RANDOM; echo $FOO \u003e file-$FOO \u0026\u0026 git add . \u0026\u0026 git commit -a -m\"Add $FOO\" \u0026\u0026 git push origin HEAD:refs/heads/main\n\n# Bitmap action\ntime java -jar target/actions-executor-1.0-SNAPSHOT-jar-with-dependencies.jar BitmapGenerationAction \u003cpath\u003e/foobar.git\n\n# Add commit 2\nFOO\u003d$RANDOM; echo $FOO \u003e file-$FOO \u0026\u0026 git add . \u0026\u0026 git commit -a -m\"Add $FOO\" \u0026\u0026 git push origin HEAD:refs/heads/main\n\n# Bitmap action\ntime java -jar target/actions-executor-1.0-SNAPSHOT-jar-with-dependencies.jar BitmapGenerationAction \u003cpath\u003e/foobar.git\n\ngit clone --no-local \u003cpath\u003e/foobar.git $RANDOM\n```\n\nthis fails with\n\n```\nCloning into \u00272353\u0027...\nremote: Enumerating objects: 5, done.\nremote: Total 5 (delta 0), reused 0 (delta 0), pack-reused 5\nReceiving objects: 100% (5/5), done.\nfatal: did not receive expected object 408f421864c618722e07897071a324e61b4e1ca6\nfatal: fetch-pack: invalid index-pack output\n```",
      "revId": "7e7d046387012a5e62e35187a9f76d33185a5124",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fa7b2005_faedfd66",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/internal/storage/pack/PackWriter.java",
        "patchSetId": 6
      },
      "lineNbr": 2555,
      "author": {
        "id": 1015244
      },
      "writtenOn": "2024-05-16T10:32:34Z",
      "side": 1,
      "message": "This is off by one and it is causing tests failures in `GcCommitSelectionTest`.\n\n```suggestion\n\t\treturn intStream.mapToObj(sliceIdx -\u003e new ArrayList\u003c\u003e(selectedCommits).subList((totalCommits * sliceIdx) / slices, (totalCommits * (sliceIdx + 1)) / slices));\n```",
      "range": {
        "startLine": 2555,
        "startChar": 157,
        "endLine": 2555,
        "endChar": 161
      },
      "revId": "7e7d046387012a5e62e35187a9f76d33185a5124",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    }
  ]
}
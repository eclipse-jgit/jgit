{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "9b5ba2af_0ad1906f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1015244
      },
      "writtenOn": "2024-05-14T13:20:06Z",
      "side": 1,
      "message": "I have tested this against `ghs-gym`.\n\nIt blows up during the building of the bitmap in the parallel bitmap update:\n\n```\n\t\tsliceCommits(selectedCommits, Runtime.getRuntime().availableProcessors() * 2)\n\t\t\t.parallel()\n\t\t\t.map(commitsSlice -\u003e getBitmapWithCommitSliceStream(commitsSlice, pm))\n\t\t\t.forEach(this::updateBitmap);\n```\n\nThis is the stack trace\n\n```\n➜  actions-executor git:(9ebd53b) ✗ time java -jar target/actions-executor-1.0-SNAPSHOT-jar-with-dependencies.jar BitmapGenerationAction ~/ghs/ghs-gym.git\nSLF4J: Failed to load class \"org.slf4j.impl.StaticLoggerBinder\".\nSLF4J: Defaulting to no-operation (NOP) logger implementation\nSLF4J: See http://www.slf4j.org/codes.html#StaticLoggerBinder for further details.\nCounting objects:       497195\nFinding sources:        100% (497195/497195)\nGetting sizes:          100% (185991/185991)\nCompressing objects:    100% (4409288/4409288)\nWriting objects:        100% (497195/497195)\nSelecting commits:      153459\nSelecting commits:      100% (153459/153459)\nBuilding bitmaps:         2% (  451/30029)May 14, 2024 2:30:27 PM com.gerritforge.ghs.actions.Main main\nSEVERE: Exception during the action execution. Action class: com.gerritforge.ghs.actions.BitmapGenerationAction\njava.lang.RuntimeException: java.lang.RuntimeException: org.eclipse.jgit.errors.CorruptObjectException: Object aaa83764261a794c19046b52b8ab4886a29ed0bf is corrupt: bad stream\n        at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\n        at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:77)\n        at java.base/jdk.internal.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\n        at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:499)\n        at java.base/java.lang.reflect.Constructor.newInstance(Constructor.java:480)\n        at java.base/java.util.concurrent.ForkJoinTask.getThrowableException(ForkJoinTask.java:562)\n        at java.base/java.util.concurrent.ForkJoinTask.reportException(ForkJoinTask.java:591)\n        at java.base/java.util.concurrent.ForkJoinTask.invoke(ForkJoinTask.java:689)\n        at java.base/java.util.stream.ForEachOps$ForEachOp.evaluateParallel(ForEachOps.java:159)\n        at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateParallel(ForEachOps.java:173)\n        at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:233)\n        at java.base/java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:596)\n        at org.eclipse.jgit.internal.storage.pack.PackWriter.prepareBitmapIndex(PackWriter.java:2520)\n        at com.gerritforge.ghs.actions.BitmapGenerator.writePack(BitmapGenerator.java:401)\n        at com.gerritforge.ghs.actions.BitmapGenerator.repackAndGenerateBitmap(BitmapGenerator.java:171)\n        at com.gerritforge.ghs.actions.BitmapGenerationAction.prepareBitmap(BitmapGenerationAction.java:28)\n        at com.gerritforge.ghs.actions.BitmapGenerationAction.apply(BitmapGenerationAction.java:40)\n        at com.gerritforge.ghs.actions.BitmapGenerationAction.apply(BitmapGenerationAction.java:23)\n        at com.gerritforge.ghs.actions.Main.main(Main.java:44)\n        ```",
      "revId": "0ffa4c44e96c6c74fac40b04159b2d428a7f5a01",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dab85a58_9c376023",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1015244
      },
      "writtenOn": "2024-05-14T13:37:29Z",
      "side": 1,
      "message": "The error is different for different executions.\nPerhaps a concurrency issue?\n\n```\n➜  actions-executor git:(9ebd53b) ✗ time java -jar target/actions-executor-1.0-SNAPSHOT-jar-with-dependencies.jar BitmapGenerationAction ~/ghs/ghs-gym.git\nSLF4J: Failed to load class \"org.slf4j.impl.StaticLoggerBinder\".\nSLF4J: Defaulting to no-operation (NOP) logger implementation\nSLF4J: See http://www.slf4j.org/codes.html#StaticLoggerBinder for further details.\nCounting objects:       497195\nFinding sources:        100% (497195/497195)\nGetting sizes:          100% (185991/185991)\nCompressing objects:    100% (4409288/4409288)\nWriting objects:        100% (497195/497195)\nSelecting commits:      153459\nSelecting commits:      100% (153459/153459)\nBuilding bitmaps:         4% ( 1052/30029)May 14, 2024 3:35:42 PM com.gerritforge.ghs.actions.Main main\nSEVERE: Exception during the action execution. Action class: com.gerritforge.ghs.actions.BitmapGenerationAction\njava.lang.RuntimeException: java.lang.RuntimeException: org.eclipse.jgit.errors.MissingObjectException: Missing commit e6e15ea3cde11e85d229d8f80b721a04eaa53120\n        at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\n        at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:77)\n        at java.base/jdk.internal.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\n        at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:499)\n        at java.base/java.lang.reflect.Constructor.newInstance(Constructor.java:480)\n        at java.base/java.util.concurrent.ForkJoinTask.getThrowableException(ForkJoinTask.java:562)\n        at java.base/java.util.concurrent.ForkJoinTask.reportException(ForkJoinTask.java:591)\n        at java.base/java.util.concurrent.ForkJoinTask.invoke(ForkJoinTask.java:689)\n        at java.base/java.util.stream.ForEachOps$ForEachOp.evaluateParallel(ForEachOps.java:159)\n        at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateParallel(ForEachOps.java:173)\n        at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:233)\n        at java.base/java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:596)\n        at org.eclipse.jgit.internal.storage.pack.PackWriter.prepareBitmapIndex(PackWriter.java:2520)\n        at com.gerritforge.ghs.actions.BitmapGenerator.writePack(BitmapGenerator.java:401)\n        at com.gerritforge.ghs.actions.BitmapGenerator.repackAndGenerateBitmap(BitmapGenerator.java:171)\n        at com.gerritforge.ghs.actions.BitmapGenerationAction.prepareBitmap(BitmapGenerationAction.java:28)\n        at com.gerritforge.ghs.actions.BitmapGenerationAction.apply(BitmapGenerationAction.java:40)\n        at com.gerritforge.ghs.actions.BitmapGenerationAction.apply(BitmapGenerationAction.java:23)\n        at com.gerritforge.ghs.actions.Main.main(Main.java:44)\nCaused by: java.lang.RuntimeException: org.eclipse.jgit.errors.MissingObjectException: Missing commit e6e15ea3cde11e85d229d8f80b721a04eaa53120\n        at org.eclipse.jgit.internal.storage.pack.PackWriter.lambda$5(PackWriter.java:2542)\n        at java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:197)\n        at java.base/java.util.AbstractList$RandomAccessSpliterator.forEachRemaining(AbstractList.java:720)\n        at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)\n        at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)\n        at java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:150)\n        at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:173)\n        at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\n        at java.base/java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:596)\n        at org.eclipse.jgit.internal.storage.pack.PackWriter.updateBitmap(PackWriter.java:2563)\n        at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:183)\n        at java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:197)\n        at java.base/java.util.stream.IntPipeline$1$1.accept(IntPipeline.java:180)\n        at java.base/java.util.stream.Streams$RangeIntSpliterator.forEachRemaining(Streams.java:104)\n        at java.base/java.util.Spliterator$OfInt.forEachRemaining(Spliterator.java:711)\n        at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)\n        at java.base/java.util.stream.ForEachOps$ForEachTask.compute(ForEachOps.java:290)\n        at java.base/java.util.concurrent.CountedCompleter.exec(CountedCompleter.java:754)\n        at java.base/java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:373)\n        at java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(ForkJoinPool.java:1182)\n        at java.base/java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:1655)\n        at java.base/java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1622)\n        at java.base/java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:165)\nCaused by: org.eclipse.jgit.errors.MissingObjectException: Missing commit e6e15ea3cde11e85d229d8f80b721a04eaa53120\n        at org.eclipse.jgit.internal.storage.file.WindowCursor.open(WindowCursor.java:138)\n        at org.eclipse.jgit.revwalk.RevWalk.getCachedBytes(RevWalk.java:1188)\n        at org.eclipse.jgit.revwalk.RevCommit.parseHeaders(RevCommit.java:149)\n        at org.eclipse.jgit.revwalk.PendingGenerator.next(PendingGenerator.java:122)\n        at org.eclipse.jgit.revwalk.RevWalk.next(RevWalk.java:647)\n        at org.eclipse.jgit.revwalk.ObjectWalk.next(ObjectWalk.java:362)\n        at org.eclipse.jgit.revwalk.BitmapWalker.findObjectsWalk(BitmapWalker.java:215)\n        at org.eclipse.jgit.revwalk.BitmapWalker.findObjects(BitmapWalker.java:131)\n        at org.eclipse.jgit.internal.storage.pack.PackWriter.getBitmapObjects(PackWriter.java:2558)\n        at org.eclipse.jgit.internal.storage.pack.PackWriter.lambda$5(PackWriter.java:2538)\n        ... 22 more\n```",
      "parentUuid": "9b5ba2af_0ad1906f",
      "revId": "0ffa4c44e96c6c74fac40b04159b2d428a7f5a01",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3fc60ff6_bf83b4d7",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/internal/storage/file/PackBitmapIndexBuilder.java",
        "patchSetId": 3
      },
      "lineNbr": 162,
      "author": {
        "id": 1015244
      },
      "writtenOn": "2024-05-14T12:27:27Z",
      "side": 1,
      "message": "this is unused and should be removed to avoid compilatin failures:\n\n```\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.12.1:compile (default-compile) on project org.eclipse.jgit: Compilation failure\n[ERROR] /Users/syntonyze/dev/source/gerritforge-health-service/components/actions-executor/modules/jgit/org.eclipse.jgit/src/org/eclipse/jgit/internal/storage/file/PackBitmapIndexBuilder.java:[162,18] The value of the local variable bitmapToWrite is not used\n```",
      "range": {
        "startLine": 162,
        "startChar": 0,
        "endLine": 162,
        "endChar": 31
      },
      "revId": "0ffa4c44e96c6c74fac40b04159b2d428a7f5a01",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1d287f1e_24b5f187",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/internal/storage/pack/PackWriter.java",
        "patchSetId": 3
      },
      "lineNbr": 47,
      "author": {
        "id": 1015244
      },
      "writtenOn": "2024-05-14T12:27:27Z",
      "side": 1,
      "message": "this is unused and it should be removed to avoid compilation errors:\n\n```\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.12.1:compile (default-compile) on project org.eclipse.jgit: Compilation failure: Compilation failure:\n[ERROR] /Users/syntonyze/dev/source/gerritforge-health-service/components/actions-executor/modules/jgit/org.eclipse.jgit/src/org/eclipse/jgit/internal/storage/file/PackBitmapIndexBuilder.java:[162,18] The value of the local variable bitmapToWrite is not used\n[ERROR] /Users/syntonyze/dev/source/gerritforge-health-service/components/actions-executor/modules/jgit/org.eclipse.jgit/src/org/eclipse/jgit/internal/storage/pack/PackWriter.java:[47,8] The import java.util.stream.Collectors is never used\n```",
      "range": {
        "startLine": 47,
        "startChar": 0,
        "endLine": 47,
        "endChar": 35
      },
      "revId": "0ffa4c44e96c6c74fac40b04159b2d428a7f5a01",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7807e97a_7341a455",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/internal/storage/pack/PackWriter.java",
        "patchSetId": 3
      },
      "lineNbr": 2529,
      "author": {
        "id": 1015244
      },
      "writtenOn": "2024-05-14T20:17:38Z",
      "side": 1,
      "message": "the `reader` cannot be shared across different thread, in order to do that, we should use `reader.newReader()` so that each slice gets a new instance of a `reader`.",
      "range": {
        "startLine": 2529,
        "startChar": 4,
        "endLine": 2529,
        "endChar": 10
      },
      "revId": "0ffa4c44e96c6c74fac40b04159b2d428a7f5a01",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    }
  ]
}
{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "a693ca43_898aa3c5",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1684
      },
      "writtenOn": "2023-04-26T05:56:04Z",
      "side": 1,
      "message": "This is not accurate, the CL I634b92877f also added SnapshottingRefDirectoryTest, that derives from non abstract test class RefDirectoryTest, so that the bazel test was already broken earlier.",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 10,
        "endChar": 34
      },
      "revId": "9ff9de5b7b75ef1d2b606f9078e815fdd15e373b",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8bfb1e37_a21dbfda",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 307638
      },
      "writtenOn": "2023-04-26T06:14:10Z",
      "side": 1,
      "message": "I1db6fcf414b was merged on Mar 03, I634b92877f was merged on mar 31? I1db6fcf414b is the first to break?",
      "parentUuid": "a693ca43_898aa3c5",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 10,
        "endChar": 34
      },
      "revId": "9ff9de5b7b75ef1d2b606f9078e815fdd15e373b",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a9b1fdbb_5ddf94d7",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1684
      },
      "writtenOn": "2023-04-26T06:28:37Z",
      "side": 1,
      "message": "Right, still mention the another breakage?",
      "parentUuid": "8bfb1e37_a21dbfda",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 10,
        "endChar": 34
      },
      "revId": "9ff9de5b7b75ef1d2b606f9078e815fdd15e373b",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7d417cbf_19e0cd15",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 307638
      },
      "writtenOn": "2023-04-26T06:29:31Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "a9b1fdbb_5ddf94d7",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 10,
        "endChar": 34
      },
      "revId": "9ff9de5b7b75ef1d2b606f9078e815fdd15e373b",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f92a8235_0a0efe6c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 307638
      },
      "writtenOn": "2023-04-24T10:41:10Z",
      "side": 1,
      "message": "trigger build",
      "revId": "9ff9de5b7b75ef1d2b606f9078e815fdd15e373b",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b5630fd7_af72fc3b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 307638
      },
      "writtenOn": "2023-04-24T11:05:52Z",
      "side": 1,
      "message": "The bazel build is failing on stable-6.1 due to other reasons. One stable-6.5, those errors are not there, so posting results of stable-6.5 with and without this fix.\n\nWithout this change\n```\nbazelisk test //org.eclipse.jgit.test:org_eclipse_jgit_internal_storage_file_RefDirectoryAfterOpenConfigTest\nINFO: Invocation ID: fdcf7b7e-4ba2-4138-81fe-c06c3a5e93a0\nINFO: Analyzed target //org.eclipse.jgit.test:org_eclipse_jgit_internal_storage_file_RefDirectoryAfterOpenConfigTest (5 packages loaded, 275 targets configured).\nINFO: Found 1 test target...\nERROR: /Users/xxxx/Clones/googlegerrit3/modules/jgit/org.eclipse.jgit.test/BUILD:50:6: Building org.eclipse.jgit.test/org_eclipse_jgit_internal_storage_file_RefDirectoryAfterOpenConfigTest.jar (2 source files) failed: (Exit 1): java failed: error executing command external/remotejdk11_macos/bin/java -XX:-CompactStrings \u0027--add-exports\u003djdk.compiler/com.sun.tools.javac.api\u003dALL-UNNAMED\u0027 \u0027--add-exports\u003djdk.compiler/com.sun.tools.javac.main\u003dALL-UNNAMED\u0027 ... (remaining 17 arguments skipped)\norg.eclipse.jgit.test/tst/org/eclipse/jgit/internal/storage/file/RefDirectoryAfterOpenConfigTest.java:19: error: cannot find symbol\npublic class RefDirectoryAfterOpenConfigTest extends RefDirectoryTest {\n                                                     ^\n  symbol: class RefDirectoryTest\norg.eclipse.jgit.test/tst/org/eclipse/jgit/internal/storage/file/RefDirectoryAfterOpenConfigTest.java:21: error: method does not override or implement a method from a supertype\n\t@Override\n\t^\norg.eclipse.jgit.test/tst/org/eclipse/jgit/internal/storage/file/RefDirectoryAfterOpenConfigTest.java:28: error: cannot find symbol\n\t\tsuper.refDirectorySetup();\n\t\t^\n  symbol:   variable super\n  location: class RefDirectoryAfterOpenConfigTest\nTarget //org.eclipse.jgit.test:org_eclipse_jgit_internal_storage_file_RefDirectoryAfterOpenConfigTest failed to build\nUse --verbose_failures to see the command lines of failed build steps.\nINFO: Elapsed time: 19.211s, Critical Path: 18.35s\nINFO: 10 processes: 1 disk cache hit, 2 internal, 4 darwin-sandbox, 3 worker.\nFAILED: Build did NOT complete successfully\n//org.eclipse.jgit.test:org_eclipse_jgit_internal_storage_file_RefDirectoryAfterOpenConfigTest FAILED TO BUILD\n\nFAILED: Build did NOT complete successfully\n```\n\nWith this change\n```\nbazelisk test //org.eclipse.jgit.test:org_eclipse_jgit_internal_storage_file_RefDirectoryAfterOpenConfigTest\nINFO: Invocation ID: 0098f9f1-0f14-4cbd-88f1-40bf67bb5adb\nINFO: Analyzed target //org.eclipse.jgit.test:org_eclipse_jgit_internal_storage_file_RefDirectoryAfterOpenConfigTest (32 packages loaded, 1521 targets configured).\nINFO: Found 1 test target...\nTarget //org.eclipse.jgit.test:org_eclipse_jgit_internal_storage_file_RefDirectoryAfterOpenConfigTest up-to-date:\n  bazel-bin/org.eclipse.jgit.test/org_eclipse_jgit_internal_storage_file_RefDirectoryAfterOpenConfigTest.jar\n  bazel-bin/org.eclipse.jgit.test/org_eclipse_jgit_internal_storage_file_RefDirectoryAfterOpenConfigTest\nINFO: Elapsed time: 47.718s, Critical Path: 46.29s\nINFO: 18 processes: 4 internal, 9 darwin-sandbox, 5 worker.\nINFO: Build completed successfully, 18 total actions\n//org.eclipse.jgit.test:org_eclipse_jgit_internal_storage_file_RefDirectoryAfterOpenConfigTest PASSED in 9.0s\n\nExecuted 1 out of 1 test: 1 test passes.\nINFO: Build completed successfully, 18 total actions\n```\n\nSimilar results for FileRepositoryBuilderAfterOpenConfigTest.",
      "revId": "9ff9de5b7b75ef1d2b606f9078e815fdd15e373b",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2c5b2e57_0004a476",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 4
      },
      "writtenOn": "2023-04-24T19:54:27Z",
      "side": 1,
      "message": "I am wondering why the bazel build for this change raises errors for\n- ReferenceEquality\n- StringEquality\ndespite the fact that these patterns are set to WARN in tools/BUILD\n\n@davido: do you have an idea why this configuration seems to be ignored ?",
      "revId": "9ff9de5b7b75ef1d2b606f9078e815fdd15e373b",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c54ac967_1aa2c9cc",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1684
      },
      "writtenOn": "2023-04-24T20:45:32Z",
      "side": 1,
      "message": "Good question, will try to look into it in the next days.",
      "parentUuid": "2c5b2e57_0004a476",
      "revId": "9ff9de5b7b75ef1d2b606f9078e815fdd15e373b",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e6e21dfb_bfe7e671",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1684
      },
      "writtenOn": "2023-04-26T05:43:21Z",
      "side": 1,
      "message": "I bumped Bazel to 6.1.2 and java_tools to v12.1 like you did in Gerrit in change 201500 and I cannot reproduce the above problem.",
      "parentUuid": "c54ac967_1aa2c9cc",
      "revId": "9ff9de5b7b75ef1d2b606f9078e815fdd15e373b",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "54c6e88a_0edc687d",
        "filename": "org.eclipse.jgit.test/BUILD",
        "patchSetId": 1
      },
      "lineNbr": 61,
      "author": {
        "id": 1684
      },
      "writtenOn": "2023-04-24T20:45:32Z",
      "side": 1,
      "message": "Why these classes added here and not to the HELPERS definition on line: 10?",
      "range": {
        "startLine": 58,
        "startChar": 0,
        "endLine": 61,
        "endChar": 16
      },
      "revId": "9ff9de5b7b75ef1d2b606f9078e815fdd15e373b",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d18a7881_0b9f679a",
        "filename": "org.eclipse.jgit.test/BUILD",
        "patchSetId": 1
      },
      "lineNbr": 61,
      "author": {
        "id": 307638
      },
      "writtenOn": "2023-04-25T04:29:55Z",
      "side": 1,
      "message": "We are excluding the HELPERS classes for running tests in line 51. We need to keep running FileRepositoryBuilderTest and RefDirectoryTest tests, so added them here.",
      "parentUuid": "54c6e88a_0edc687d",
      "range": {
        "startLine": 58,
        "startChar": 0,
        "endLine": 61,
        "endChar": 16
      },
      "revId": "9ff9de5b7b75ef1d2b606f9078e815fdd15e373b",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9ebf43d3_4be96c30",
        "filename": "org.eclipse.jgit.test/BUILD",
        "patchSetId": 1
      },
      "lineNbr": 61,
      "author": {
        "id": 1684
      },
      "writtenOn": "2023-04-26T05:43:21Z",
      "side": 1,
      "message": "Yes, so the issue here is, that after I1db6fcf414b FileRepositoryBuilderTest and RefDirectoryTest are both: base classes (helpers) and own test in the same time.\n\nAnd if those classes are not helpers, they shouldn\u0027t be a part of the helpers java library. Otherwise, the build code readability and maintainability would suffer.\n\nThe Bazel build structure doesn\u0027t ave a good support for test by inheritance for non abstract base classes, as mentioned by Han-Wen Nienhuys in this comment: [1], that is originated from this 5 years old feature request: [2].\n\nGerrit project has two different idioms to cope with this limitation, \n\n1. Abstract base class and some kind of configuration in derived classes.\nExamples:\n\n* javatests/com/google/gerrit/acceptance/git/HttpSubmitOnPushIT.java\n* javatests/com/google/gerrit/acceptance/git/AbstractSubmitOnPush.java\n\n2. Multiple configuration injection in the same class. For ReviewDb vs, NoteDb persistence @Config annotation was introduced. And it was possible to switch to different configs, without extacting the configuration code in its own new derived class.\n\nBut given that we have test breakage here, and stable branches are affected, I would just add temporarily new java library, something like:\n\n```\n# Non abstract base classes used for tests by other test classes\nBASE \u003d [\n    PKG + \"internal/storage/file/FileRepositoryBuilderTest.java\",\n    PKG + \"internal/storage/file/RefDirectoryTest.java\",\n]\n\njava_library(\n    name \u003d \"base\",\n    testonly \u003d 1,\n    srcs \u003d BASE,\n    deps \u003d [\n        \"//lib:junit\",\n        \"//org.eclipse.jgit:jgit\",\n        \"//org.eclipse.jgit.junit:junit\",\n    ],\n)\n```\n\nand either include this new library for all tests in tests.bzl:\n\n```\n    junit_tests(\n        name \u003d name,\n        tags \u003d labels,\n        srcs \u003d [src],\n        deps \u003d additional_deps + [\n            \":base\",\n            \":helpers\",\n[...]\n```\n\nor even only do it for these three needed test classes tests.bzl:\n\n```\n        if src.endswith(\"FileRepositoryBuilderAfterOpenConfigTest.java\") \\\n           or src.endswith(\"RefDirectoryAfterOpenConfigTest.java\") \\\n           or src.endswith(\"SnapshottingRefDirectoryTest.java\"):\n            additional_deps \u003d [\n                \":base\",\n            ]\n```\n\nThat way, the base library would only be built, if a specific test, that uses this library is executed, e.g:\n\n\n```\n  $ bazel test \\\n//org.eclipse.jgit.test:org_eclipse_jgit_internal_storage_file_SnapshottingRefDirectoryTest\n  \n```\n\n\n\n[1] https://git.eclipse.org/r/c/jgit/jgit/+/200304/1/org.eclipse.jgit.test/tst/org/eclipse/jgit/internal/storage/file/FileRepositoryBuilderAfterOpenConfigTest.java#25\n[2] https://github.com/bazelbuild/bazel/issues/2539",
      "parentUuid": "d18a7881_0b9f679a",
      "range": {
        "startLine": 58,
        "startChar": 0,
        "endLine": 61,
        "endChar": 16
      },
      "revId": "9ff9de5b7b75ef1d2b606f9078e815fdd15e373b",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "dadab260_f18a399b",
        "filename": "org.eclipse.jgit.test/BUILD",
        "patchSetId": 1
      },
      "lineNbr": 61,
      "author": {
        "id": 307638
      },
      "writtenOn": "2023-04-26T06:36:38Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "9ebf43d3_4be96c30",
      "range": {
        "startLine": 58,
        "startChar": 0,
        "endLine": 61,
        "endChar": 16
      },
      "revId": "9ff9de5b7b75ef1d2b606f9078e815fdd15e373b",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31"
    }
  ]
}
{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "3d4862fb_6e330282",
        "filename": "/COMMIT_MSG",
        "patchSetId": 7
      },
      "lineNbr": 9,
      "author": {
        "id": 1020855
      },
      "writtenOn": "2024-10-17T21:55:00Z",
      "side": 1,
      "message": "We are doing this to fit \"cache over multiple tables\", so it should be explained here. Also, IIUC, this is just a refactor to accommodate later the List\u003cstats\u003e API, right?\n\nUse the first paragraph for the problem. e.g.\n\nThe DfsBlockCache can use internally more than one table, but the stats API assumes only one. This has worked so far because we return the aggregated stats of all tables, but to fine-tune the cache, we need also the stats of each table.\n\nAnd the second/third paragraphs explains your solution, e.g.\n\nRefactor the code, so instead of an implementation of stats for one table and implementation for n tables, we have just the implementation (for a single table) and an aggregator class.\n\nLater we can make the cache return a list stats and let the caller aggregate if needed.",
      "revId": "1c7de77c1b8132f851500b5c6908588f3abe7775",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a215be6b_0b46fd7e",
        "filename": "/COMMIT_MSG",
        "patchSetId": 7
      },
      "lineNbr": 9,
      "author": {
        "id": 1037574
      },
      "writtenOn": "2024-10-18T00:23:15Z",
      "side": 1,
      "message": "\u003e We are doing this to fit \"cache over multiple tables\", so it should be explained here\n\nThis isn\u0027t really adding any new functionality (other than changing AggregatedBlockCacheStats from private in PackExt). So \"what we are doing\" is what we were already doing.\n\n\u003e Also, IIUC, this is just a refactor to accommodate later the List\u003cstats\u003e API, right?\n\nThat\u0027s the reason why this change started, but imo this structure makes more sense than the non-uniform use of inner classes (some were done in the block cache interface class, some in a cache implmenetation). Both implementations that were moved to their own files are generic enough to not be specific to any one implementation (hence the name change to AggregatedBlockCacheStats).\n\nI considered moving AggregatedBlockCacheStats to where DfsBlockCacheStats was defined, but instead chose to move the implemenations to their own files producing this change that\u0027s effectively a move.\n\n\u003e (...)\n\nThe rest of this comment will be considered, but I wanted to hear your thoughts from these replies first.",
      "parentUuid": "3d4862fb_6e330282",
      "revId": "1c7de77c1b8132f851500b5c6908588f3abe7775",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1b7f8029_2c322ac9",
        "filename": "/COMMIT_MSG",
        "patchSetId": 7
      },
      "lineNbr": 9,
      "author": {
        "id": 1020855
      },
      "writtenOn": "2024-10-18T17:37:52Z",
      "side": 1,
      "message": "\u003e This isn\u0027t really adding any new functionality (other than changing AggregatedBlockCacheStats from private in PackExt). So \"what we are doing\" is what we were already doing.\n\nIt took me a while to realize that this is just moving code around.\n\nFor somebody without context, it is not clear *why* do we need this change (to accommodate \"multitable stats\"). \n\nBoth things deserve to be mentioned in the commit message.\n\n\u003e  Both implementations that were moved to their own files are generic enough to not be specific to any one implementation\n\nWe expect the aggregator to be public and makes sense as top-level class. For the table stats, the instances are always created by the ClockBlockCacheTable (because PackExt...Table is just a collection of individual tables). I would expect the stats class to be inside the ClockBlockCacheTable (maybe even with a private constructor), and only make it to a top-level class when we have another implementation that needs it.\n\nI do similar comment in the stats class itself, sorry for the duplication.",
      "parentUuid": "a215be6b_0b46fd7e",
      "revId": "1c7de77c1b8132f851500b5c6908588f3abe7775",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "429654a9_c2ad2445",
        "filename": "/COMMIT_MSG",
        "patchSetId": 7
      },
      "lineNbr": 9,
      "author": {
        "id": 1037574
      },
      "writtenOn": "2024-10-21T18:31:35Z",
      "side": 1,
      "message": "I\u0027ve updated the description. \n\nFor the second part: we can keep the discussions in the other threads.",
      "parentUuid": "1b7f8029_2c322ac9",
      "revId": "1c7de77c1b8132f851500b5c6908588f3abe7775",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cbc63d71_63aff7f5",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/internal/storage/dfs/AggregatedBlockCacheStats.java",
        "patchSetId": 7
      },
      "lineNbr": 25,
      "author": {
        "id": 1020855
      },
      "writtenOn": "2024-10-17T21:55:00Z",
      "side": 1,
      "message": "Should this name be just the concatenated name of the tables?",
      "range": {
        "startLine": 25,
        "startChar": 27,
        "endLine": 25,
        "endChar": 38
      },
      "revId": "1c7de77c1b8132f851500b5c6908588f3abe7775",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a278e063_627a2d43",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/internal/storage/dfs/AggregatedBlockCacheStats.java",
        "patchSetId": 7
      },
      "lineNbr": 25,
      "author": {
        "id": 1020855
      },
      "writtenOn": "2024-10-17T21:55:00Z",
      "side": 1,
      "message": "Maybe we could use a factory method to cover the (very common) single table case:\n\n```\nstatic BlockCacheStats fromStats(List\u003cBlockCacheStats\u003e stats) {\n  if (stats.size() \u003d\u003d 1) {\n    return stats.get(0);\n  }\n  return new AggregatedBlockCacheStats(stats);\n}\n```?\n\nThis could be checked by each table class... but that depends on what is the intended final API.",
      "revId": "1c7de77c1b8132f851500b5c6908588f3abe7775",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "332912b6_6da7f9e9",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/internal/storage/dfs/AggregatedBlockCacheStats.java",
        "patchSetId": 7
      },
      "lineNbr": 25,
      "author": {
        "id": 1037574
      },
      "writtenOn": "2024-10-18T00:23:15Z",
      "side": 1,
      "message": "Maybe, but if so this should be done in a different change as it would change existing functionality.",
      "parentUuid": "cbc63d71_63aff7f5",
      "range": {
        "startLine": 25,
        "startChar": 27,
        "endLine": 25,
        "endChar": 38
      },
      "revId": "1c7de77c1b8132f851500b5c6908588f3abe7775",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "eddc25e7_e43aa08f",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/internal/storage/dfs/AggregatedBlockCacheStats.java",
        "patchSetId": 7
      },
      "lineNbr": 25,
      "author": {
        "id": 1037574
      },
      "writtenOn": "2024-10-18T00:23:15Z",
      "side": 1,
      "message": "Sure, done! Makes the case of a single entry a little \"safer\" in that it doesn\u0027t need to go through extra functions.",
      "parentUuid": "a278e063_627a2d43",
      "revId": "1c7de77c1b8132f851500b5c6908588f3abe7775",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5c161136_284d7921",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/internal/storage/dfs/AggregatedBlockCacheStats.java",
        "patchSetId": 7
      },
      "lineNbr": 25,
      "author": {
        "id": 1020855
      },
      "writtenOn": "2024-10-18T17:37:52Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "332912b6_6da7f9e9",
      "range": {
        "startLine": 25,
        "startChar": 27,
        "endLine": 25,
        "endChar": 38
      },
      "revId": "1c7de77c1b8132f851500b5c6908588f3abe7775",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e4d78fa7_a64960b8",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/internal/storage/dfs/DfsBlockCacheStats.java",
        "patchSetId": 7
      },
      "lineNbr": 21,
      "author": {
        "id": 1020855
      },
      "writtenOn": "2024-10-17T21:55:00Z",
      "side": 1,
      "message": "Optional: Move this as a protected static inner class in the table?",
      "revId": "1c7de77c1b8132f851500b5c6908588f3abe7775",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9490c292_6780e4da",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/internal/storage/dfs/DfsBlockCacheStats.java",
        "patchSetId": 7
      },
      "lineNbr": 21,
      "author": {
        "id": 1037574
      },
      "writtenOn": "2024-10-18T00:23:15Z",
      "side": 1,
      "message": "I don\u0027t think there\u0027s a good reason to move it to an inner class as it\u0027s not specific to any one cache implementation.",
      "parentUuid": "e4d78fa7_a64960b8",
      "revId": "1c7de77c1b8132f851500b5c6908588f3abe7775",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "10b423b3_00767c6c",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/internal/storage/dfs/DfsBlockCacheStats.java",
        "patchSetId": 7
      },
      "lineNbr": 21,
      "author": {
        "id": 1020855
      },
      "writtenOn": "2024-10-18T17:37:52Z",
      "side": 1,
      "message": "It is only instantiated from the clock table and at the moment there is no reason for anybody else to instantiate it.\n\nOptional as it is not big drama as a top-level class when it has package-only visibility.",
      "parentUuid": "9490c292_6780e4da",
      "revId": "1c7de77c1b8132f851500b5c6908588f3abe7775",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d9bf8840_1bf60047",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/internal/storage/dfs/DfsBlockCacheStats.java",
        "patchSetId": 7
      },
      "lineNbr": 21,
      "author": {
        "id": 1037574
      },
      "writtenOn": "2024-10-21T18:31:35Z",
      "side": 1,
      "message": "Acknowledged.\n\n\u003e at the moment\n\nYes for the moment it\u0027s only being used with the clock table, but nothing actually links it to that implementation.",
      "parentUuid": "10b423b3_00767c6c",
      "revId": "1c7de77c1b8132f851500b5c6908588f3abe7775",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    }
  ]
}
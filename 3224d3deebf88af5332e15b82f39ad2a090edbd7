{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "a6d74976_f6cbbf75",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 39
      },
      "lineNbr": 0,
      "author": {
        "id": 307629
      },
      "writtenOn": "2023-06-01T08:06:28Z",
      "side": 1,
      "message": "Adding Josh for +1 review",
      "revId": "3224d3deebf88af5332e15b82f39ad2a090edbd7",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2924095f_9b6e74ac",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 39
      },
      "lineNbr": 0,
      "author": {
        "id": 150123
      },
      "writtenOn": "2023-06-02T00:15:53Z",
      "side": 1,
      "message": "Could the reverse index remain one concrete class instead of two (ComputedPackReverseIndex and PackReverseIndexV1)?\n\nThe way I see it, the existing class has 2 main parts: one that computes from an existing pack and stores its computation into some data structures, and the other that presents the data in its data structures in a digestible way. I think that your new class will end up using the same data structures (in particular, you\u0027re not mmap-ping or a bulk array copy or anything like that - you\u0027re reading integer by integer, as far as I can tell), so it would end up duplicating the presentation of data part. If we instead added a new factory method that read from a file and stored it into the same data structures, I think this would be less code and thus more easily maintainable.",
      "revId": "3224d3deebf88af5332e15b82f39ad2a090edbd7",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3a542845_502a306c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 39
      },
      "lineNbr": 0,
      "author": {
        "id": 307629
      },
      "writtenOn": "2023-06-02T08:00:40Z",
      "side": 1,
      "message": "Thanks for the comment, Jonathan. Please take a look at org.eclipse.jgit/src/org/eclipse/jgit/internal/storage/file/PackReverseIndexV1.java in https://git.eclipse.org/r/c/jgit/jgit/+/197590. The internal data is much simpler and much easier to understand.\n\nGenerally, I believe that an abstraction layer and two simpler implementations is easier to maintain than one awkward and complicated implementation. \n\nI spent time trying to reuse parts of the ComputedReverseIndex and discussing it with Ivan; and the input data and internal state are too different for a reasonably clean reuse.\n\nIf you feel strongly about squashing the two implementations together, I\u0027d love to see your proposal for an equivalent of org.eclipse.jgit/src/org/eclipse/jgit/internal/storage/file/PackReverseIndexV1.java in https://git.eclipse.org/r/c/jgit/jgit/+/197590.",
      "parentUuid": "2924095f_9b6e74ac",
      "revId": "3224d3deebf88af5332e15b82f39ad2a090edbd7",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f3e52db6_f9900455",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 39
      },
      "lineNbr": 0,
      "author": {
        "id": 307629
      },
      "writtenOn": "2023-06-02T08:00:40Z",
      "side": 1,
      "message": "Assigning Ivan for +2 review.\n\nThanks Josh for taking a look!",
      "revId": "3224d3deebf88af5332e15b82f39ad2a090edbd7",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ee74faf1_44ff0645",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 39
      },
      "lineNbr": 0,
      "author": {
        "id": 201156
      },
      "writtenOn": "2023-06-08T16:02:03Z",
      "side": 1,
      "message": "IIRC the \"on-demand\" implementation receives a list of elements in sha1 order, creates the list in offset order and an \"fanout\" table over it to search. Search has two steps (fanout + inside data range)\n\nIn the file implementation we have already the sorted list of offsets and just load into memory and binary search over it.\n\nThe \"fanout\" table ties loading/searching and makes sharing code between implementations odd and convoluted (see Anna\u0027s linked change). \n\nWe could get rid of the fanout in the \"on-demand\" implementation, but that code has been working well for long time and we rather keep it as it is.\n\nWe could also add the fanout for the \"on-file\" version, then split only the \"build a list of ordered offsets\"... but the point of the fanout is that is build in the same iteration than the sorting, so it can make on-demand worse (?)",
      "parentUuid": "3a542845_502a306c",
      "revId": "3224d3deebf88af5332e15b82f39ad2a090edbd7",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ecd3fc92_2946f113",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/internal/storage/file/ComputedPackReverseIndex.java",
        "patchSetId": 39
      },
      "lineNbr": 2,
      "author": {
        "id": 201156
      },
      "writtenOn": "2023-06-08T16:02:03Z",
      "side": 1,
      "message": "2023",
      "range": {
        "startLine": 2,
        "startChar": 17,
        "endLine": 2,
        "endChar": 21
      },
      "revId": "3224d3deebf88af5332e15b82f39ad2a090edbd7",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1a5570c3_ebe7e89b",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/internal/storage/file/ComputedPackReverseIndex.java",
        "patchSetId": 39
      },
      "lineNbr": 26,
      "author": {
        "id": 201156
      },
      "writtenOn": "2023-06-08T16:02:03Z",
      "side": 1,
      "message": "It is easier to navigate these classes if they have a consistent/parallel naming, maybe something like \"PackReverseIndexComputed\" and \"PackReverseIndexFileV1\"?",
      "range": {
        "startLine": 26,
        "startChar": 12,
        "endLine": 26,
        "endChar": 36
      },
      "revId": "3224d3deebf88af5332e15b82f39ad2a090edbd7",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "79933076_5300da10",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/internal/storage/file/PackReverseIndex.java",
        "patchSetId": 39
      },
      "lineNbr": 26,
      "author": {
        "id": 201156
      },
      "writtenOn": "2023-06-08T16:02:03Z",
      "side": 1,
      "message": "This looks and acts as an interface and the only specific part is to choose the instance. Make this an interface and create a factory?",
      "revId": "3224d3deebf88af5332e15b82f39ad2a090edbd7",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31"
    }
  ]
}
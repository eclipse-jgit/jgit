{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "85fc56c8_3d3591d9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 38
      },
      "lineNbr": 0,
      "author": {
        "id": 1000671
      },
      "writtenOn": "2025-07-28T19:57:10Z",
      "side": 1,
      "message": "Regarding Tony\u0027s comment on the build failing against gerrit 3.12, I think we should build against gerrit master since jgit servlet-4 branch follows the jgit master branch.\n\nI think Gerrit master should build against JGit servlet-4, but a JGit change may break build of Gerrit stable branches. If a JGit change merging master to servlet-4 breaks the build of Gerrit master we should not submit this JGit merge until a Gerrit change fixing this problem is available.",
      "revId": "0c79e3aa38c3918b8c42587d0880f1036531e73b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a2ae52f6_66a6171d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 38
      },
      "lineNbr": 0,
      "author": {
        "id": 1015244
      },
      "writtenOn": "2025-07-31T07:28:29Z",
      "side": 1,
      "message": "Currently the build *passes* against `stable-3.12` and `master`.\nI can see occasional failures (on both `master` and `stable-3.12`, when the build runs on my machine, due to the flakiness of `FileReftableTest:testConcurrentRacyReload`.",
      "parentUuid": "85fc56c8_3d3591d9",
      "revId": "0c79e3aa38c3918b8c42587d0880f1036531e73b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b5240dd8_753a9ef8",
        "filename": "Jenkinsfile",
        "patchSetId": 38
      },
      "lineNbr": 15,
      "author": {
        "id": 1021966
      },
      "writtenOn": "2025-07-28T14:37:13Z",
      "side": 1,
      "message": "What about the license? I get this is for Gerrit and it\u0027s basically an integration build for Gerrit; but still: normally contributions in the JGit repo are EDL-2.0, not APL-2.0.",
      "revId": "0c79e3aa38c3918b8c42587d0880f1036531e73b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e744d9b4_d12089b3",
        "filename": "Jenkinsfile",
        "patchSetId": 38
      },
      "lineNbr": 15,
      "author": {
        "id": 1015244
      },
      "writtenOn": "2025-07-31T07:28:29Z",
      "side": 1,
      "message": "It\u0027s a good point Thomas.\nWe should either conform the licence or perhaps move the Jenkinsfile to the `gerrit-ci-scripts` as suggested by @luca.milanesio@gmail.com at [1].\nLeaving this comment as unresolved for now.\n\n\n[1] https://eclipse.gerrithub.io/c/eclipse-jgit/jgit/+/1218954/comment/3b2c0b8e_70f304a8/",
      "parentUuid": "b5240dd8_753a9ef8",
      "revId": "0c79e3aa38c3918b8c42587d0880f1036531e73b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3b2c0b8e_70f304a8",
        "filename": "Jenkinsfile",
        "patchSetId": 38
      },
      "lineNbr": 18,
      "author": {
        "id": 1021966
      },
      "writtenOn": "2025-07-28T14:37:13Z",
      "side": 1,
      "message": "Do you have any countermeasures in place on the Gerrit build system against Jenkinsfile abuse? If the build picks up this Jenkinsfile from changes in review and executes it: how do you prevent someone pushing a change \"for review\" with a modified Jenkinsfile that does something else entirely? Or is that a non-issue for the Gerrit build system?",
      "revId": "0c79e3aa38c3918b8c42587d0880f1036531e73b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b10e00da_84454b54",
        "filename": "Jenkinsfile",
        "patchSetId": 38
      },
      "lineNbr": 18,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2025-07-28T19:49:59Z",
      "side": 1,
      "message": "\u003e Do you have any countermeasures in place on the Gerrit build system against Jenkinsfile abuse? \n\nJenkinsfile pipelines run inside the Jenkins Groovy sandbox and cannot do arbitrary script actions, unless we explicitly authorise them.\n\n\u003e If the build picks up this Jenkinsfile from changes in review and executes it: how do you prevent someone pushing a change \"for review\" with a modified Jenkinsfile that does something else entirely?\n\nThat also applies to any change pushed \"for review\" with a test class that does something else entirely. Actually the execution of Jenkinsfile has a lot more restrictions than the test code execution.\n\n\u003e Or is that a non-issue for the Gerrit build system?\n\nWe discussed the issue in the past and concluded that the risk was for now acceptable and did not want to limit the CI validations to only a set of _trusted contributors_. \nI believe there isn\u0027t such restriction in the current Eclipse\u0027s build triggered pipeline and any change from any contributor will trigger a CI execution.",
      "parentUuid": "3b2c0b8e_70f304a8",
      "revId": "0c79e3aa38c3918b8c42587d0880f1036531e73b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "36ad6aa5_b14e4292",
        "filename": "Jenkinsfile",
        "patchSetId": 38
      },
      "lineNbr": 18,
      "author": {
        "id": 1000671
      },
      "writtenOn": "2025-07-28T20:07:59Z",
      "side": 1,
      "message": "Yes, but so far contributors cannot modify the existing jgit CI jobs.\n\nIn EGit we put source code of CI jobs into a separate repo egit-pipelines which ensures that a contribution to that repo has no effect on EGit builds until the corresponding change was approved and submitted by a committer.\n\nI think we should do the same with the JGit CI jobs and move the CI pipeline definitions to the jgit-pipelines repo (which already exists, but I didn\u0027t yet find time to move the pipeline definitions there).",
      "parentUuid": "b10e00da_84454b54",
      "revId": "0c79e3aa38c3918b8c42587d0880f1036531e73b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "92de6d4d_8891f98e",
        "filename": "Jenkinsfile",
        "patchSetId": 38
      },
      "lineNbr": 18,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2025-07-28T20:29:32Z",
      "side": 1,
      "message": "\u003e Yes, but so far contributors cannot modify the existing jgit CI jobs.\n\nTrue, and your worry is that this Jenkinsfile instead would break that rule, point taken.\n\n\u003e In EGit we put source code of CI jobs into a separate repo egit-pipelines which ensures that a contribution to that repo has no effect on EGit builds until the corresponding change was approved and submitted by a committer.\n\nWe do almost the same in Gerrit, with the build scripts stored in the Gerrit repository, but Jenkinsfile is an exception at the moment. I believe it would make sense to do the same with Gerrit, but then we\u0027ll have to restrict the contributions to the Gerrit repository; otherwise, it would not make any difference.\n\n\u003e I think we should do the same with the JGit CI jobs and move the CI pipeline definitions to the jgit-pipelines repo (which already exists, but I didn\u0027t yet find time to move the pipeline definitions there).\n\nSure and agreed. This change though isn\u0027t really a CI for JGit, which continues to be done with the Gerrit Trigger Plugin, but rather a _safety net_ for preventing future breakages on the `servlet-4` with Gerrit.\n\nFrom that point of view, I believe this script does not belong to the JGit project, but it should be fully self-contained in the gerrit-ci-scripts project in Gerrit.",
      "parentUuid": "36ad6aa5_b14e4292",
      "revId": "0c79e3aa38c3918b8c42587d0880f1036531e73b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "39bce21a_df8bbbdd",
        "filename": "Jenkinsfile",
        "patchSetId": 38
      },
      "lineNbr": 18,
      "author": {
        "id": 1015244
      },
      "writtenOn": "2025-07-31T07:28:29Z",
      "side": 1,
      "message": "\u003e From that point of view, I believe this script does not belong to the JGit project, but it should be fully self-contained in the gerrit-ci-scripts project in Gerrit.\n\n+1\n\nShould we move pipeline in gerrit-ci-scripts then?",
      "parentUuid": "92de6d4d_8891f98e",
      "revId": "0c79e3aa38c3918b8c42587d0880f1036531e73b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8fb6cea6_cb878a66",
        "filename": "Jenkinsfile",
        "patchSetId": 38
      },
      "lineNbr": 18,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2025-07-31T21:00:34Z",
      "side": 1,
      "message": "\u003e \u003e From that point of view, I believe this script does not belong to the JGit project, but it should be fully self-contained in the gerrit-ci-scripts project in Gerrit.\n\u003e \n\u003e +1\n\u003e \n\u003e Should we move pipeline in gerrit-ci-scripts then?\n\nYes, exactly as we do for Gerrit and its plugins\u0027 pipelines definitions.",
      "parentUuid": "39bce21a_df8bbbdd",
      "revId": "0c79e3aa38c3918b8c42587d0880f1036531e73b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d1ac4160_eb4e8ded",
        "filename": "Jenkinsfile",
        "patchSetId": 38
      },
      "lineNbr": 18,
      "author": {
        "id": 1015244
      },
      "writtenOn": "2025-08-04T07:42:07Z",
      "side": 1,
      "message": "@twolf@apache.org, @matthias.sohn@sap.com, @luca.milanesio@gmail.com,\n\nUnfortunately the plan to have a **completely** self-contained pipeline in `gerrit-ci-script` cannot be achieved, as we planned.\n\nTo make usage of the `Gerrit Code Review plugin` and validate JGit changes _as they are created/updated_ we need to use a **multi-branch job**. However, **multi-branch jobs** cannot execute arbitrary code. They _must_ have a Jenkinsfile in the target repo, in this case JGit.\n\nTo have _direct_ control on the Groovy script path, one must configure a **pipeline job** (we can use the _dsl_ property), however this has no native understanding of the SCM changes being tested (i.e.\nJGit changes) and it does not work with `Gerrit Code Review plugin`.\n\nSo, as things stand, I don’t see a clean way to automatically discover and validate JGit changes without placing a **Jenkinsfile** in the JGit repo.\n\nHowever, here an alternative approach that perhaps can address all concerns:\n\n1 - We introduce a _minimal_ JenkinsFile in the Jgit code (just on the **servlet-4** branch). This `Jenkinsfile` has **no logic**,it just provides the **glue** for the pipeline to work.\n\nWe already do something similar for the plugins pipelines by allowing them to call exclusively a routine defined in the `gerrit-ci-scripts`. An example [here](https://gerrit.googlesource.com/plugins/multi-site/+/refs/heads/master/Jenkinsfile).\n\nThe Jenkinsfile could be as simple as:\n\n```\nJgitPipeline()\n```\n\nOr something along those lines.\n\n2. We pack the pipeline logic in the `gerrit-ci-scripts`, similarly to what we do for plugins [here](https://gerrit.googlesource.com/gerrit-ci-scripts/+/refs/heads/master/vars/pluginPipeline.groovy#49)\n\n3. We address any security concerns about who can upload/modify a `Jenkinsfile` in `JGit` through other means. For example:\n   - Preventing `Jenkinsfile` to be uploaded by anyone who is noy in a trusted group (i.e. Maintainers).\n   - Introducing submit-requirements that prevent Jenkinsfiles to be merged unless  uploaded by a trusted group.\n   - Extending the gerrit trigger plugin with an option to trigger only on specific branches, rather than all changes.\n   \nWhat do you think @twolf@apache.org, @matthias.sohn@sap.com, @luca.milanesio@gmail.com? I am happy to follow this route if we get consensus this is an acceptable way forward.",
      "parentUuid": "8fb6cea6_cb878a66",
      "revId": "0c79e3aa38c3918b8c42587d0880f1036531e73b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "294d3ce2_b1c349b7",
        "filename": "Jenkinsfile",
        "patchSetId": 38
      },
      "lineNbr": 18,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2025-08-04T07:52:46Z",
      "side": 1,
      "message": "I believe that would work, but I want to see first the Gerrit Code Review plugin changes deployed and used in other Gerrit plugins so that we have a real life validation that the process works.\n\nAlso this approach is useful for Gerrit plugins to avoid abusers running pipeline code on the CI by just creating a random change.",
      "parentUuid": "d1ac4160_eb4e8ded",
      "revId": "0c79e3aa38c3918b8c42587d0880f1036531e73b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    }
  ],
  "submitRequirementResults": []
}